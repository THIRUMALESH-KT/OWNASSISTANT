<!DOCTYPE html>
<html>
<body>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        let recognition;

        const startRecognition = () => {
            recognition = new webkitSpeechRecognition();
            recognition.onstart = () => {
                output.textContent = 'Listening... (Say "done" to stop)';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                output.textContent = transcript;
                sendAudioToServer(transcript);
            };

            recognition.start();
        };

        const stopRecognition = () => {
            if (recognition) {
                recognition.stop();
                output.textContent = 'Recognition stopped.';
            }
        };

        const sendAudioToServer = (audioData) => {
            fetch('/voice-to-text', {
                method: 'POST',
                body: JSON.stringify({ audioData }),
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.text())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
        };

        startRecognition(); // Start listening immediately
    </script>
</body>
</html>
